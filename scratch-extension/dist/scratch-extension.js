module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){e.exports=class{onInit(){}onUninit(){}beforeProjectLoad(e,t){}beforeProjectSave(e){}}},function(e,t,n){let o=!1,i=null;e.exports={registExtensionAPI:function(e){o||(i=e,o=!0)},...n(7),addCategory:e=>i.vm.addCategory(e),removeCategory:e=>i.vm.removeCategory(e),addBlock:e=>i.vm.addBlock(e),addBlocks:e=>i.vm.addBlocks(e),removeBlock:e=>i.vm.removeBlock(e),removeBlocks:e=>i.vm.removeBlocks(e),getPlaygroundData:()=>i.vm.getPlaygroundData(),loadProject:(e,t)=>i.vm.loadProject(e,t),isDesktop:()=>i.gui.isDesktop(),getSettings:e=>i.gui.getSettings(e),isEditorLoading:()=>i.gui.isEditorLoading(),getVmInstance:()=>i.vm.vm,getGuiDocument:()=>i.document,getGuiWindow:()=>i.window,getGuiInstance:()=>i.gui.gui,getBlockInstance:()=>i.blocks,getRenderInstance:()=>i.vm.vm.renderer,getStageCanvas:()=>i.vm.vm.renderer.canvas}},function(e,t){e.exports={BlockType:{COMMAND:1,REPORTER:2,BOOLEAN:3,HAT:5},ParameterType:{NUMBER:1,STRING:2,BOOLEAN:3,ANY:4,COLOR:5,MATRIX:6,NOTE:7,ANGLE:8,IMAGE:99},ShadowType:{NO_SHADOW:!1,ANGLE:{type:"math_angle",fieldName:"NUM"},COLOR:{type:"colour_picker",fieldName:"COLOUR"},NUMBER:{type:"math_number",fieldName:"NUM"},STRING:{type:"text",fieldName:"TEXT"},MATRIX:{type:"matrix",fieldName:"MATRIX"},NOTE:{type:"note",fieldName:"NOTE"}},FilterType:{SPRITE:["sprite"],STAGE:["stage"],ALL:["sprite","stage"],HIDE:[]}}},function(e,t,n){const o=n(4),i=144,s=145,r=1061109567;e.exports={Graph:class{constructor(){this.edge={},this.node={},this.nodeCount=0}addNode(e){this.node.hasOwnProperty(e)||(this.node[e]={in:0,out:0},this.edge[e]={},++this.nodeCount)}hasNode(e){return this.node.hasOwnProperty(e)}addEdge(e,t,n,o){if(this.addNode(e),this.addNode(t),this.edge[e][t])throw i;this.edge[e][t]={w:n,data:o},++this.node[e].out,++this.node[t].in}dijkstra(e,t){const n={};for(const t in this.node)n[t]={vis:!1,dis:this.edge[e].hasOwnProperty(t)?this.edge[e][t].w:r,path:this.edge[e].hasOwnProperty(t)?[{from:e,to:t}]:[]};n[e].dis=0,n[e].vis=!1;let o=1;for(;o!==this.nodeCount;){let e=null,t=r;for(const o in this.node)!n[o].vis&&n[o].dis<t&&(t=n[o].dis,e=o);if(null===e)return[];n[e].vis=!0,++o;for(const t in this.node)!n[t].vis&&this.edge[e].hasOwnProperty(t)&&n[e].dis+this.edge[e][t].w<n[t].dis&&(n[t].dis=n[e].dis+this.edge[e][t].w,n[t].path=Object.assign([],n[e].path),n[t].path.push({from:e,to:t}))}return n[t].path}bfs(e,t){const n=[],o={};for(n.push(e);n.length>0;){const e=n.shift();for(const t in this.edge[e])o[t]||(o[t]=Object.assign([],o[e]),o[t].push({from:e,to:t}),n.push(t))}return o[t]||[]}topo(){const e=[],t=[],n=o(this.node);for(const t in n)0===n[t].in&&e.push(t);for(;e.length>0;){const o=e.shift();t.push(o);for(const t in this.edge[o])--n[t].in,0===n[t].in&&e.push(t)}if(t.length!==this.nodeCount)throw s;return t}},ERROR_DUPLICATED_EDGE:i,ERROR_NO_TOPO_ORDER:s}},function(e,t){e.exports=function e(t){const n=Array.isArray(t)?[]:{};if("object"!=typeof t)return t;for(const o in t)n[o]="object"==typeof t[o]?e(t[o]):t[o];return n}},function(e,t,n){const o=n(0),i=n(6),s=n(8),{ExtensionManager:r,LoadMode:a,extensionManager:d,ERROR_UNAVAILABLE_EXTENSION:c,ERROR_CIRCULAR_REQUIREMENT:h}=n(9),l=n(1),u=n(2);e.exports={Extension:o,CompatibleExtension:i,MigrationHelper:s,ExtensionManager:r,LoadMode:a,error:{ERROR_UNAVAILABLE_EXTENSION:c,ERROR_CIRCULAR_REQUIREMENT:h},extensionManager:d,api:l,type:u}},function(e,t,n){const o=n(0),i=n(1),s=n(2);e.exports=class extends o{constructor(e){super(),this.instance=e}onInit(){const e=this.instance.getInfo();this.extensionId=e.id;const t=this.extensionId+"."+e.name;i.addCategory({categoryId:t,messageId:e.name,color:e.color1});for(const n of e.blocks){const e={};for(const t in n.arguments)e[t]={type:this.getArgumentType(n.arguments[t].type),default:n.arguments[t].defaultValue};i.addBlock({opcode:this.extensionId+"."+n.opcode,type:this.getBlockType(n.blockType),messageId:n.text,categoryId:t,function:this.instance[n.opcode],argument:e})}}getBlockType(e){switch(e){case"Boolean":return s.BlockType.BOOLEAN;case"button":return 0;case"command":return s.BlockType.COMMAND;case"conditional":return 0;case"event":case"hat":return s.BlockType.HAT;case"loop":return 0;case"reporter":return s.BlockType.REPORTER;default:return 0}}getArgumentType(e){switch(e){case"angle":return 0;case"Boolean":return s.ParameterType.BOOLEAN;case"color":return s.ParameterType.COLOR;case"number":return s.ParameterType.NUMBER;case"string":return s.ParameterType.STRING;case"matrix":case"note":case"image":default:return 0}}}},function(e,t){const n={};e.exports={registerGlobalFunction:(e,t)=>{if(n.hasOwnProperty(e))throw"Register an existed global function.";n[e]=t},unregisterGlobalFunction:e=>{if(!n.hasOwnProperty(e))throw"Try to unregister an unexisted global function.";delete n[e]},callGlobalFunction:(e,...t)=>{if(!n.hasOwnProperty(e))throw"Call an unexisted global function.";return n[e](...t)},migrateChangeBlock:(e,t,n)=>{for(const o of e){console.log(o.blocks._blocks);for(const e in o.blocks._blocks)console.log(e),o.blocks._blocks[e].opcode===t&&(o.blocks._blocks[e].opcode=n)}}}},function(e,t,n){const{Graph:o,ERROR_DUPLICATED_EDGE:i}=n(3);e.exports=class{constructor(){this.graph=new o}addVersionMigration(e,t,n){try{this.graph.addEdge(e,t,1,n)}catch(e){throw e===i?"Duplicated version migration.":e}}migrationFromVersion(e,t,n){const o=this.graph.bfs(e,t);if(0===o.length)throw"No valid migration path.";for(const e of o)this.graph.edge[e.from][e.to].data(n)}}},function(e,t,n){const{Graph:o}=n(3),{matchVersion:i}=n(10),s={UNLOAD:0,INITIATIVE_LOAD:1,PASSIVE_LOAD:2},r=144,a=145;class d{constructor(){this.info={},this.instance={},this.load={}}addInstance(e,t,n){this.instance.hasOwnProperty(e)||(this.info[e]=Object.assign({dependency:{},optional:!1},t),this.load[e]=s.UNLOAD,this.instance[e]=n)}removeInstance(e){this.instance.hasOwnProperty(e)&&(delete this.info[e],delete this.load[e],delete this.instance[e])}getInstance(e){return this.instance[e]}getInfo(e){return console.log(this.info),this.info[e]}exist(e){return this.instance.hasOwnProperty(e)}setLoadStatus(e,t){this.load[e]=t}getLoadStatus(e){return this.load[e]}getLoadedExtensions(e=!1){const t={};for(const n in this.load)!this.load[n]||!e&&this.info[n].optional||(t[n]=this.info[n].version);return t}getLoadedExtensionsList(e=!1){const t=[];for(const n in this.load)!this.load[n]||!e&&this.info[n].optional||t.push({id:n,version:this.info[n].version});return t}getLoadedExtensionsIdList(e=!1){const t=[];for(const n in this.load)!this.load[n]||!e&&this.info[n].optional||t.push(n);return t}loadExtensionsWithMode(e,t){for(const n of e)this.getLoadStatus(n.id)||(this.info[n.id].api?this.instance[n.id].onInit():t(n.id),this.setLoadStatus(n.id,n.mode))}unloadExtensions(e,t){for(const n of e)this.getLoadStatus(n)&&(this.info[n].api?this.instance[n].onUninit():t(n),this.setLoadStatus(n,s.UNLOAD))}getExtensionLoadOrder(e){const t=new o;for(const n of e){if(!this.info.hasOwnProperty(n))throw console.error(`Unavailable extension: ${n}`),{code:r,extension:[{id:n,version:"any"}],requireStack:[]};this._checkExtensionLoadingOrderById(n,[],t)}return t.topo().map(t=>({id:t,mode:e.includes(t)?s.INITIATIVE_LOAD:s.PASSIVE_LOAD}))}_findIdInList(e,t){for(const n in t)if(t[n].id===e)return n;return-1}_checkExtensionLoadingOrderById(e,t,n){t.push({id:e,version:this.info[e].version}),n.hasNode(e)||n.addNode(e);for(const o in this.info[e].dependency){if(!this.info.hasOwnProperty(o))throw{code:r,extension:[{id:o,version:this.info[e].dependency[o]}],requireStack:t};if(this._findIdInList(o,t)>=0)throw{code:a,requireStack:t};const s=this.info[e].dependency[o];if(!i(this.info[o].version,s))throw{code:r,extension:[{id:o,version:this.info[e].dependency[o]}],requireStack:t};n.addEdge(o,e),this._checkExtensionLoadingOrderById(o,t,n)}t.pop()}getExtensionUnloadOrder(e){const t=new o;for(const n of e)this.load.hasOwnProperty(n)&&this.load[n]&&this._checkExtensionUnloadingOrderById(n,t);return t.topo()}_checkExtensionUnloadingOrderById(e,t,n){t.hasNode(e)||t.addNode(e);for(const o in this.load)o!==n&&this.load[o]&&this.info[o].dependency.hasOwnProperty(e)&&(t.addEdge(o,e),this._checkExtensionUnloadingOrderById(o,t,e));for(const o in this.info[e].dependency)o!==n&&this.load[o]===s.PASSIVE_LOAD&&(t.addEdge(e,o),this._checkExtensionUnloadingOrderById(o,t,e))}static _printRequireStack(e){for(;e.length>0;){const t=e.pop();console.error(`    required by ${t.id}(${t.version})`)}}emitEventToExtension(e,t,...n){if(!this.instance.hasOwnProperty(e))throw`Unavaliable extension id: ${e}`;if(this.instance[e]){const o=this.instance[e][t];"function"==typeof o&&o(...n)}}emitEventToAll(e,...t){for(const n in this.instance){if(!this.instance[n])continue;const o=this.instance[n][e];"function"==typeof o&&o(...t)}}emitEvent(e,...t){for(const n in this.load)if(this.instance[n]){const o=this.instance[n][e];"function"==typeof o&&o(...t)}}}const c=new d;e.exports={ExtensionManager:d,LoadMode:s,extensionManager:c,ERROR_UNAVAILABLE_EXTENSION:r,ERROR_CIRCULAR_REQUIREMENT:a}},function(e,t,n){const o=n(4);function i(e,t){const n=e.length>t.length?e.length:t.length;for(let o=0;o<n;++o){const n=o<e.length?Number.isNaN(Number(e[o])?e[o]:Number(e[o])):0,i=o<t.length?Number.isNaN(Number(t[o])?t[o]:Number(t[o])):0;if(n<i)return-1;if(n>i)return 1}return 0}e.exports={compareParsedVersion:i,matchVersion:function(e,t){if("^"===t[0]){const n=t.substr(1).split("."),s=o(n);return s[0]=Number(s[0])+1,i(e.split("."),s)<0&&i(e.split("."),n)>=0}if("~"===t[0]){const n=t.substr(1).split("."),s=o(n);return s[1]=Number(s[1])+1,i(e.split("."),s)<0&&i(e.split("."),n)>=0}return t.includes("*")?RegExp(t.replace(/\*/g,"\\d*")).test(e):0===i(e.split("."),t.split("."))}}}]);